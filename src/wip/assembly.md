---
layout: 'base.njk'
title: 'How to program an Arduino Uno in Assembly'
description: 'TODO'
---

# {{title}}

[tutorial]: https://diataxis.fr/tutorials/
[AVR Assembly]: https://ww1.microchip.com/downloads/en/devicedoc/atmel-0856-avr-instruction-set-manual.pdf

This [tutorial] shows you how to program an Arduino Uno R3 in [AVR Assembly].
The Assembly program that you load onto the Uno just blinks the built-in LED
(pin 13) on and off.

Kudos to [mhitza](https://gist.github.com/mhitza/8a4608f4dfdec20d3879) for
documenting a workflow that gave me confidence that I could actually do this.
On that note, the top search results on this subject are surprisingly bad.
Abandon Hope All Ye Who Enter Here!

## Assumptions

If you don't have the following equipment or experience, this tutorial
may not work for you.

### Equipment

* Arduino Uno R3
* Debian-based Linux laptop
* USB-A to USB-B cable

### Experience

* Proficiency in Bash commands like `cd` and `git`
* Proficiency in programming in high-level languages
* Familiarity with using `make` to build binaries from source code (as well
  as figuring out how to install missing build toolchain dependencies)

## Setup

### Install `avra`

```
cd /tmp
git clone git@github.com:Ro5bert/avra.git
cd avra
make
cp src/avra ~/avra
```

[assembler]: https://en.wikipedia.org/wiki/Assembly_language#Assembler
[my personal backup of the `avra` source code]: https://drive.google.com/file/d/1Va9oPqrqspQvIcSHH4Dvybl4KQJg1yyf/view?usp=share_link
[Link rot]: https://en.wikipedia.org/wiki/Link_rot

`avra` will be your [assembler]. Here's [my personal backup of the `avra`
source code]. [Link rot] is real...

### Install `avrdude`

```
sudo apt-get install avrdude
```

[`avrdude`]: https://github.com/avrdudes/avrdude/
[my personal backup of the `avrdude` source code]: https://drive.google.com/file/d/1Z5cbqMHFlp_cLKEU4-wMC89l8jS47Hg8/view?usp=share_link
[*Ain't no stoppin' that entropy*]: https://youtu.be/NbuT4BkuaCk?t=135

[`avrdude`] (**AVR** **D**ownloader **U**plo**de**r) will be your tool for
programming the machine code (generated by `avra`) onto your Uno. Here's
[my personal backup of the `avrdude` source code] again.
[*Ain't no stoppin' that entropy*]...

## Create the assembly program

### `~/blink.asm`

```
.device ATmega328P

; http://www.avr-asm-tutorial.net/avr_en/timingloops/delay16.html
; http://www.rjhcoding.com/avr-asm-delay-subroutine.php
; https://ww1.microchip.com/downloads/en/devicedoc/atmel-0856-avr-instruction-set-manual.pdf
; http://darcy.rsgc.on.ca/ACES/TEI4M/AVRdelay.html

.equ PORTB = 0x05
.equ DDRB  = 0x04

.org 0x0000
    jmp setup

setup:
    sbi DDRB, 5
    clr r16
    jmp main

main:
    tst r16
    brne off
    rjmp on

on:
    sbi PORTB, 5
    ldi r16, 1
    rjmp delay

off:
    cbi PORTB, 5
    clr r16
    rjmp delay

delay:
    ldi  r18, 41
    ldi  r19, 150
    ldi  r20, 128

loop:
    dec  r20
    brne loop
    dec  r19
    brne loop
    dec  r18
    brne loop
    rjmp main
```

### `~/Makefile`

```
%.hex: %.asm
	~/Tools/avra -fI $<
	if [ -f "*.eep.hex" ]; then rm *.eep.hex; fi
	if [ -f "*.obj" ]; then rm *.obj; fi
	if [ -f "*.cof" ]; then rm *.cof; fi

all: $(patsubst %.asm,%.hex,$(wildcard *.asm))

upload: ${program}.hex
	sudo avrdude -c arduino -p m328p -P /dev/ttyACM0 -b 115200 -U flash:w:$<

# https://www.gnu.org/software/make/manual/html_node/Phony-Targets.html
.PHONY: all upload
```

## Conclusion

The [insect overlords](https://www.youtube.com/watch?v=8lcUHQYhPTE) are surely
[watching your career with great interest](https://www.youtube.com/watch?v=67h8GyNgEmA) now.
